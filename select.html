<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€‰æ‹©é¢˜åº“</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>é€‰æ‹©é¢˜åº“</h1>
        <div id="bank-list" class="bank-list">
            <div style="text-align: center; color: #666;">æ­£åœ¨æ‰«æé¢˜åº“...</div>
        </div>
        <button onclick="location.href='index.html'" style="margin-top: 20px;" class="back-btn">è¿”å›ä¸»é¡µ</button>
    </div>

    <script>
        // æ‰©å±•çš„é¢˜åº“åˆ—è¡¨ - æ”¯æŒæ›´å¤šå‘½åæ–¹å¼
        const potentialBanks = [];
        
        // è‡ªåŠ¨ç”Ÿæˆ bank1-bank20 çš„æ£€æµ‹åˆ—è¡¨
        for (let i = 1; i <= 20; i++) {
            potentialBanks.push({
                id: `bank${i}`,
                file: `data/questions-bank${i}.json`
            });
        }
        
        // ä¹Ÿæ”¯æŒå…¶ä»–å¸¸è§å‘½å
        const commonNames = ['cihui', 'yufa', 'zonghhe', 'moni', 'test', 'practice'];
        commonNames.forEach(name => {
            potentialBanks.push({
                id: name,
                file: `data/${name}.json`
            });
            potentialBanks.push({
                id: `questions-${name}`,
                file: `data/questions-${name}.json`
            });
        });

        // ä»æ–‡ä»¶åç”Ÿæˆå‹å¥½çš„æ˜¾ç¤ºåç§°
        function generateDisplayName(filename, questionCount) {
            const nameMap = {
                'bank1': 'è¯æ±‡è¾¨æ',
                'bank2': 'è¯­æ³•ä¸“é¡¹',
                'bank3': 'ç»¼åˆç»ƒä¹ ',
                'cihui': 'è¯æ±‡ç»ƒä¹ ',
                'yufa': 'è¯­æ³•ç»ƒä¹ ',
                'zonghhe': 'ç»¼åˆç»ƒä¹ ',
                'moni': 'æ¨¡æ‹Ÿæµ‹è¯•',
                'test': 'æµ‹è¯•é¢˜åº“',
                'practice': 'ç»ƒä¹ é¢˜åº“'
            };
            
            // å°è¯•ä»æ˜ å°„ä¸­è·å–åç§°
            for (let [key, value] of Object.entries(nameMap)) {
                if (filename.includes(key)) {
                    return `${value} (${questionCount}é¢˜)`;
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ˜ å°„ï¼Œä½¿ç”¨æ–‡ä»¶å
            const baseName = filename.replace('data/', '').replace('.json', '').replace('questions-', '');
            return `é¢˜åº“: ${baseName} (${questionCount}é¢˜)`;
        }

        async function loadBanks() {
            const bankListEl = document.getElementById('bank-list');
            
            // å¹¶å‘æ£€æµ‹æ‰€æœ‰å¯èƒ½çš„é¢˜åº“æ–‡ä»¶
            const checkPromises = potentialBanks.map(async (bank) => {
                try {
                    const response = await fetch(bank.file, {
                        method: 'GET',
                        cache: 'no-cache'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        // éªŒè¯æ•°æ®æ ¼å¼
                        if (Array.isArray(data) && data.length > 0) {
                            // æ£€æŸ¥ç¬¬ä¸€ä¸ªé¢˜ç›®æ˜¯å¦æœ‰å¿…éœ€çš„å­—æ®µ
                            const firstQuestion = data[0];
                            if (firstQuestion.question && firstQuestion.options && 
                                firstQuestion.correctAnswer !== undefined) {
                                
                                return {
                                    id: bank.id,
                                    file: bank.file,
                                    name: generateDisplayName(bank.file, data.length),
                                    questionCount: data.length,
                                    valid: true
                                };
                            }
                        }
                    }
                } catch (error) {
                    // æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯
                    return null;
                }
                return null;
            });

            const results = await Promise.all(checkPromises);
            const validBanks = results.filter(bank => bank !== null && bank.valid);

            if (validBanks.length === 0) {
                bankListEl.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <p style="color: #ff9800; font-size: 1.3em; margin-bottom: 15px;">ğŸ“š æœªæ‰¾åˆ°é¢˜åº“æ–‡ä»¶</p>
                        <div style="text-align: left; max-width: 500px; margin: 0 auto; background: #f5f5f5; padding: 20px; border-radius: 8px;">
                            <p style="color: #666; font-size: 0.95em; margin-bottom: 10px;">
                                <strong>è¯·åœ¨ data/ æ–‡ä»¶å¤¹ä¸­æ·»åŠ é¢˜åº“æ–‡ä»¶</strong>
                            </p>
                            <p style="color: #666; font-size: 0.9em;">æ”¯æŒçš„æ–‡ä»¶åï¼š</p>
                            <ul style="color: #666; font-size: 0.9em; margin-top: 5px;">
                                <li>questions-bank1.json</li>
                                <li>questions-bank2.json</li>
                                <li>cihui.json (è¯æ±‡)</li>
                                <li>yufa.json (è¯­æ³•)</li>
                                <li>ç­‰ç­‰...</li>
                            </ul>
                        </div>
                    </div>
                `;
                return;
            }

            // æŒ‰é¢˜ç›®æ•°é‡æ’åº
            validBanks.sort((a, b) => a.id.localeCompare(b.id));

            // æ˜¾ç¤ºæ‰¾åˆ°çš„é¢˜åº“
            bankListEl.innerHTML = '';
            validBanks.forEach(bank => {
                const bankCard = document.createElement('div');
                bankCard.className = 'bank-card';
                bankCard.innerHTML = `
                    <h3>${bank.name}</h3>
                    <p style="color: #667eea; font-size: 0.9em;">
                        ğŸ’¾ ${bank.file.replace('data/', '')}
                    </p>
                `;
                bankCard.onclick = () => {
                    localStorage.setItem('selectedBank', JSON.stringify(bank));
                    location.href = 'quiz.html';
                };
                bankListEl.appendChild(bankCard);
            });

            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const totalQuestions = validBanks.reduce((sum, bank) => sum + bank.questionCount, 0);
            const statsDiv = document.createElement('div');
            statsDiv.style.cssText = 'text-align: center; margin-top: 20px; color: #666; font-size: 0.9em;';
            statsDiv.innerHTML = `æ‰¾åˆ° ${validBanks.length} ä¸ªé¢˜åº“ï¼Œå…± ${totalQuestions} é“é¢˜ç›®`;
            document.querySelector('.container').insertBefore(statsDiv, document.querySelector('.back-btn'));
        }

        window.onload = loadBanks;
    </script>
</body>
</html>